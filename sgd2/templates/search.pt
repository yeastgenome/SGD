<div metal:use-macro="layout">
<div metal:fill-slot="content">

<!-- Subhead
================================================== -->
<body>
	<br></br>
	<div class="container-fluid">
		<div class="row-fluid">
			<div class="span3">
				<h4 id="category_header">Categories</h4>
				<ul class="unstyled">
					<li id="gene_entry" tal:condition="python: category == 'all'"><a tal:attributes="href '?keyword=' + keyword + '&category=genes'">Genes</a> <span id='gene_count' class='muted'></span></li>
          			<li id="go_entry" tal:condition="python: category == 'all'"><a tal:attributes="href '?keyword=' + keyword + '&category=goterms'">Gene Ontology Terms</a> <span id='go_count' class='muted'></span></li>
          			<li id="phenotype_entry" tal:condition="python: category == 'all'"><a tal:attributes="href '?keyword=' + keyword + '&category=phenotypes'">Phenotypes</a> <span id='phenotype_count' class='muted'></span></li>
          			<li id="reference_entry" tal:condition="python: category == 'all'"><a tal:attributes="href '?keyword=' + keyword + '&category=references'">References</a> <span id='reference_count' class='muted'></span></li>

					<li tal:condition="python: category in {'genes', 'goterms', 'phenotypes', 'references'}"><a tal:attributes="href '?keyword=' + keyword"> &lt; All Results</a></li>
					<li tal:condition="python: category == 'genes'"><strong>&nbsp;&nbsp;Genes</strong></li>
					<li tal:condition="python: category == 'goterms'"><strong>&nbsp;&nbsp;GO Terms</strong></li>
					<li tal:condition="python: category == 'phenotypes'"><strong>&nbsp;&nbsp;Phenotypes</strong></li>
					<li tal:condition="python: category == 'references'"><strong>&nbsp;&nbsp;References</strong></li>

				</ul>
			</div>
			
			<div class="span9">
				<ul tal:condition="python: category != 'all'" class="breadcrumb">
					<li><a tal:attributes="href '?keyword=' + keyword">All Results</a> <span class="divider">/</span></li>
  					
  					<li tal:condition="python: category == 'genes'" class="active">Genes</li>
  					<li tal:condition="python: category == 'goterms'" class="active">GO Terms</li>
  					<li tal:condition="python: category == 'phenotypes'" class="active">Phenotypes</li>
  					<li tal:condition="python: category == 'references'" class="active">References</li>

				</ul>
				
				<div id='page_count' class='muted'>Page <span id='page_num'></span> of <span id='num_results'></span> results.</div>
				<div class="lead" id="no_documents" style="display:none">Your search - <strong tal:content='keyword'></strong> - did not match any documents.</div>
			    <br></br>
				<div id='search_results'></div>
				<div class="pagination pagination-right" id="pagination">
				</div>
			</div>
		</div>
	</div> 
</body>

<script>
		 	
	$(document).ready(function() {
		document.getElementById("searchfield").value = '${keyword}';
		document.getElementById("page_num").innerHTML = ${page}+1;
		
		//Set up evidence table and reference list
  		$.getJSON('${results_url}', function(data) {
			var results = data['results'];
			if(data['num_results'] > 0) {
				document.getElementById("num_results").innerHTML = data['num_results'];
			}
			else {
				document.getElementById("no_documents").style.display = 'block';
				document.getElementById("page_count").style.display = 'none';
				document.getElementById("category_header").style.display = 'none';
				document.getElementById("pagination").style.display = 'none';
			}
			if('${category}' == 'all') {
				if(data['counts']['GENE'] > 0) {
					document.getElementById("gene_count").innerHTML = '(' + data['counts']['GENE'] + ')';
				}
				else {
					document.getElementById("gene_entry").innerHTML = '';
				}
				if(data['counts']['GO'] > 0) {
					document.getElementById("go_count").innerHTML = '(' + data['counts']['GO'] + ')';
				}
				else {
					document.getElementById("go_entry").innerHTML = '';
				}
				if(data['counts']['PHENOTYPE'] > 0) {
					document.getElementById("phenotype_count").innerHTML = '(' + data['counts']['PHENOTYPE'] + ')';
				}
				else {
					document.getElementById("phenotype_entry").innerHTML = '';
				}
				if(data['counts']['REFERENCE'] > 0) {
					document.getElementById("reference_count").innerHTML = '(' + data['counts']['REFERENCE'] + ')';
				}
				else {
					document.getElementById("reference_entry").innerHTML = '';
				}	
			}
			

			var results_div = document.getElementById("search_results");
			for (var i=0; i < results.length; i++) {
				var result = results[i];
				var p = document.createElement('p');
				var div1 = document.createElement('div');
				var div2 = document.createElement('div');
				var div3 = document.createElement('div');
				var div4 = document.createElement('div');
				div1.innerHTML = '<small>' + result[0] + '</small>';
				div1.className = 'muted';
				div2.innerHTML = result[1];
				div3.innerHTML = result[2];
				div4.innerHTML = result[3];
				div4.className = 'muted';
				p.appendChild(div1);
				p.appendChild(div2);
				p.appendChild(div4);
				p.appendChild(div3);
				results_div.appendChild(p);
				
				highlightSearchTerms('${keyword}', div2.childNodes[0], false, false, '<strong>', '</strong>');
				highlightSearchTerms('${keyword}', div3, false, false, '<strong>', '</strong>');
				highlightSearchTerms('${keyword}', div4, false, false, '<strong>', '</strong>');
			}
		
			//Set up pagination
			var pagination = document.getElementById("pagination");
			var ul = document.createElement('ul');
			pagination.appendChild(ul);
			
			var current_page = ${page};
			
			var li = document.createElement('li');
			var a = document.createElement('a')
			a.innerHTML = "Prev";
			a.href = "?keyword=" + '${keyword}' + "&category=" + '${category}' + "&page=" + (current_page-1);
			li.appendChild(a);
			ul.appendChild(li);
			if(${page} == 0) {
				li.className = 'disabled';
			}
		
			var num_pages = data['num_pages'];
			var start = Math.max(0, current_page-5);
			var end = Math.min(num_pages, start+10);
			
			for (var i=start; i < end; i++) {
				var li = document.createElement('li');
				var a = document.createElement('a');
				a.innerHTML = (i+1);
				a.href = "?keyword=" + '${keyword}' + "&category=" + '${category}' + "&page=" + i;			
				if(${page} == i) {
					li.className = 'active';
				}
				li.appendChild(a);
				ul.appendChild(li);
			}
			
			var li = document.createElement('li');
			var a = document.createElement('a');
			a.innerHTML = "Next";
			a.href = "?keyword=" + '${keyword}' + "&category=" + '${category}' + "&page=" + (current_page+1);
			li.appendChild(a);
			ul.appendChild(li);
			if(${page} == num_pages-1) {
				li.className = 'disabled';
			}

	} );
	} );
</script>
 
</div>
</div>
